{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///D:/search-engine-spec/lib/db.ts"],"sourcesContent":["import { Pool } from 'pg';\r\n\r\nconst pool = new Pool({\r\n    connectionString: process.env.DATABASE_URL || 'postgresql://postgres:postgres@localhost:5432/search_engine',\r\n    ssl: process.env.NODE_ENV === 'production' ? { rejectUnauthorized: false } : false,\r\n});\r\n\r\nexport default pool;\r\n"],"names":[],"mappings":";;;;AAAA;;;;;;AAEA,MAAM,OAAO,IAAI,4GAAI,CAAC;IAClB,kBAAkB,QAAQ,GAAG,CAAC,YAAY,IAAI;IAC9C,KAAK,sCAAwC,0BAAgC;AACjF;uCAEe"}},
    {"offset": {"line": 74, "column": 0}, "map": {"version":3,"sources":["file:///D:/search-engine-spec/lib/services/search-service.ts"],"sourcesContent":["import pool from '../db';\r\n\r\nexport interface SearchParams {\r\n    query: string;\r\n    page?: number;\r\n    pageSize?: number;\r\n    filters?: {\r\n        language?: string;\r\n        dateRange?: {\r\n            start: string;\r\n            end: string;\r\n        };\r\n        site?: string;\r\n    };\r\n}\r\n\r\nexport interface SearchResult {\r\n    doc_id: string;\r\n    url: string;\r\n    title: string;\r\n    snippet: string;\r\n    score: number;\r\n    highlights: string[];\r\n    metadata: {\r\n        author?: string;\r\n        published_date?: string;\r\n        language?: string;\r\n    };\r\n}\r\n\r\nexport interface SearchResponse {\r\n    query: {\r\n        original: string;\r\n        corrected?: string;\r\n        intent?: string;\r\n    };\r\n    results: SearchResult[];\r\n    total_results: number;\r\n    page: number;\r\n    page_size: number;\r\n    query_time_ms: number;\r\n    suggestions: string[];\r\n}\r\n\r\nexport class SearchService {\r\n    async search(params: SearchParams): Promise<SearchResponse> {\r\n        const startTime = Date.now();\r\n        const { query, page = 1, pageSize = 10 } = params;\r\n        const offset = (page - 1) * pageSize;\r\n\r\n        // Basic full-text search implementation using PostgreSQL tsvector\r\n        // In a real scenario, this would query Elasticsearch\r\n        const sql = `\r\n      SELECT \r\n        doc_id, \r\n        url, \r\n        title, \r\n        meta_description, \r\n        pagerank,\r\n        ts_rank(to_tsvector('english', title || ' ' || coalesce(meta_description, '')), to_tsquery('english', $1)) as rank\r\n      FROM documents\r\n      WHERE to_tsvector('english', title || ' ' || coalesce(meta_description, '')) @@ to_tsquery('english', $1)\r\n      ORDER BY rank DESC, pagerank DESC\r\n      LIMIT $2 OFFSET $3\r\n    `;\r\n\r\n        // Convert query to tsquery format (basic)\r\n        const formattedQuery = query.trim().split(/\\s+/).join(' & ');\r\n\r\n        try {\r\n            const result = await pool.query(sql, [formattedQuery, pageSize, offset]);\r\n            const totalCountRes = await pool.query(\r\n                \"SELECT COUNT(*) FROM documents WHERE to_tsvector('english', title || ' ' || coalesce(meta_description, '')) @@ to_tsquery('english', $1)\",\r\n                [formattedQuery]\r\n            );\r\n            const totalResults = parseInt(totalCountRes.rows[0].count, 10);\r\n\r\n            const searchResults: SearchResult[] = result.rows.map((row: any) => ({\r\n                doc_id: row.doc_id,\r\n                url: row.url,\r\n                title: row.title,\r\n                snippet: row.meta_description || '', // Simplified snippet\r\n                score: row.rank,\r\n                highlights: [query], // Simplified highlights\r\n                metadata: {\r\n                    language: 'en', // Default\r\n                },\r\n            }));\r\n\r\n            const endTime = Date.now();\r\n\r\n            return {\r\n                query: {\r\n                    original: query,\r\n                },\r\n                results: searchResults,\r\n                total_results: totalResults,\r\n                page,\r\n                page_size: pageSize,\r\n                query_time_ms: endTime - startTime,\r\n                suggestions: [], // Implement suggestion logic if needed\r\n            };\r\n        } catch (error) {\r\n            console.error('Search error:', error);\r\n            throw error;\r\n        }\r\n    }\r\n\r\n    async suggest(query: string, limit: number = 10): Promise<string[]> {\r\n        const sql = `\r\n      SELECT query_text \r\n      FROM query_suggestions \r\n      WHERE query_text ILIKE $1 \r\n      ORDER BY frequency DESC \r\n      LIMIT $2\r\n    `;\r\n        try {\r\n            const result = await pool.query(sql, [`${query}%`, limit]);\r\n            return result.rows.map((row: any) => row.query_text);\r\n        } catch (error) {\r\n            console.error('Suggestion error:', error);\r\n            return [];\r\n        }\r\n    }\r\n}\r\n\r\nexport const searchService = new SearchService();\r\n"],"names":[],"mappings":";;;;;;AAAA;;;;;;AA4CO,MAAM;IACT,MAAM,OAAO,MAAoB,EAA2B;QACxD,MAAM,YAAY,KAAK,GAAG;QAC1B,MAAM,EAAE,KAAK,EAAE,OAAO,CAAC,EAAE,WAAW,EAAE,EAAE,GAAG;QAC3C,MAAM,SAAS,CAAC,OAAO,CAAC,IAAI;QAE5B,kEAAkE;QAClE,qDAAqD;QACrD,MAAM,MAAM,CAAC;;;;;;;;;;;;IAYjB,CAAC;QAEG,0CAA0C;QAC1C,MAAM,iBAAiB,MAAM,IAAI,GAAG,KAAK,CAAC,OAAO,IAAI,CAAC;QAEtD,IAAI;YACA,MAAM,SAAS,MAAM,sHAAI,CAAC,KAAK,CAAC,KAAK;gBAAC;gBAAgB;gBAAU;aAAO;YACvE,MAAM,gBAAgB,MAAM,sHAAI,CAAC,KAAK,CAClC,4IACA;gBAAC;aAAe;YAEpB,MAAM,eAAe,SAAS,cAAc,IAAI,CAAC,EAAE,CAAC,KAAK,EAAE;YAE3D,MAAM,gBAAgC,OAAO,IAAI,CAAC,GAAG,CAAC,CAAC,MAAa,CAAC;oBACjE,QAAQ,IAAI,MAAM;oBAClB,KAAK,IAAI,GAAG;oBACZ,OAAO,IAAI,KAAK;oBAChB,SAAS,IAAI,gBAAgB,IAAI;oBACjC,OAAO,IAAI,IAAI;oBACf,YAAY;wBAAC;qBAAM;oBACnB,UAAU;wBACN,UAAU;oBACd;gBACJ,CAAC;YAED,MAAM,UAAU,KAAK,GAAG;YAExB,OAAO;gBACH,OAAO;oBACH,UAAU;gBACd;gBACA,SAAS;gBACT,eAAe;gBACf;gBACA,WAAW;gBACX,eAAe,UAAU;gBACzB,aAAa,EAAE;YACnB;QACJ,EAAE,OAAO,OAAO;YACZ,QAAQ,KAAK,CAAC,iBAAiB;YAC/B,MAAM;QACV;IACJ;IAEA,MAAM,QAAQ,KAAa,EAAE,QAAgB,EAAE,EAAqB;QAChE,MAAM,MAAM,CAAC;;;;;;IAMjB,CAAC;QACG,IAAI;YACA,MAAM,SAAS,MAAM,sHAAI,CAAC,KAAK,CAAC,KAAK;gBAAC,GAAG,MAAM,CAAC,CAAC;gBAAE;aAAM;YACzD,OAAO,OAAO,IAAI,CAAC,GAAG,CAAC,CAAC,MAAa,IAAI,UAAU;QACvD,EAAE,OAAO,OAAO;YACZ,QAAQ,KAAK,CAAC,qBAAqB;YACnC,OAAO,EAAE;QACb;IACJ;AACJ;AAEO,MAAM,gBAAgB,IAAI"}},
    {"offset": {"line": 176, "column": 0}, "map": {"version":3,"sources":["file:///D:/search-engine-spec/app/api/v1/search/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\r\nimport { searchService } from '@/lib/services/search-service';\r\n\r\nexport async function POST(req: NextRequest) {\r\n    try {\r\n        const body = await req.json();\r\n        const { query, page, page_size, filters } = body;\r\n\r\n        if (!query) {\r\n            return NextResponse.json(\r\n                {\r\n                    error: {\r\n                        code: 'INVALID_QUERY',\r\n                        message: 'Query string is required',\r\n                        details: { field: 'query', constraint: 'non_empty' },\r\n                    },\r\n                    request_id: `req_${Date.now()}`,\r\n                },\r\n                { status: 400 }\r\n            );\r\n        }\r\n\r\n        const results = await searchService.search({\r\n            query,\r\n            page,\r\n            pageSize: page_size,\r\n            filters,\r\n        });\r\n\r\n        return NextResponse.json(results);\r\n    } catch (error) {\r\n        console.error('Search API error:', error);\r\n        return NextResponse.json(\r\n            {\r\n                error: {\r\n                    code: 'INTERNAL_ERROR',\r\n                    message: 'An internal server error occurred',\r\n                },\r\n                request_id: `req_${Date.now()}`,\r\n            },\r\n            { status: 500 }\r\n        );\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;;;;;AAEO,eAAe,KAAK,GAAgB;IACvC,IAAI;QACA,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,MAAM,EAAE,KAAK,EAAE,IAAI,EAAE,SAAS,EAAE,OAAO,EAAE,GAAG;QAE5C,IAAI,CAAC,OAAO;YACR,OAAO,gJAAY,CAAC,IAAI,CACpB;gBACI,OAAO;oBACH,MAAM;oBACN,SAAS;oBACT,SAAS;wBAAE,OAAO;wBAAS,YAAY;oBAAY;gBACvD;gBACA,YAAY,CAAC,IAAI,EAAE,KAAK,GAAG,IAAI;YACnC,GACA;gBAAE,QAAQ;YAAI;QAEtB;QAEA,MAAM,UAAU,MAAM,uJAAa,CAAC,MAAM,CAAC;YACvC;YACA;YACA,UAAU;YACV;QACJ;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;IAC7B,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,qBAAqB;QACnC,OAAO,gJAAY,CAAC,IAAI,CACpB;YACI,OAAO;gBACH,MAAM;gBACN,SAAS;YACb;YACA,YAAY,CAAC,IAAI,EAAE,KAAK,GAAG,IAAI;QACnC,GACA;YAAE,QAAQ;QAAI;IAEtB;AACJ"}}]
}