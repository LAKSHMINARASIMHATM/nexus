{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///D:/search-engine-spec/lib/validation/schemas.ts"],"sourcesContent":["import { z } from 'zod';\r\n\r\n/**\r\n * Validation schemas for API request validation\r\n * Using Zod for type-safe runtime validation\r\n */\r\n\r\n// Search query validation\r\nexport const searchRequestSchema = z.object({\r\n  query: z\r\n    .string()\r\n    .trim()\r\n    .min(1, 'Query cannot be empty')\r\n    .max(500, 'Query too long (max 500 characters)')\r\n    .transform((val) => sanitizeQuery(val)),\r\n  page: z\r\n    .number()\r\n    .int()\r\n    .positive()\r\n    .max(100, 'Page number too high')\r\n    .default(1)\r\n    .optional(),\r\n  page_size: z\r\n    .number()\r\n    .int()\r\n    .positive()\r\n    .min(1)\r\n    .max(100, 'Page size too large')\r\n    .default(10)\r\n    .optional(),\r\n  filters: z\r\n    .object({\r\n      language: z.string().length(2).optional(),\r\n      site: z.string().url().or(z.string().regex(/^[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$/)).or(z.array(z.string())).optional(),\r\n      dateRange: z\r\n        .object({\r\n          start: z.string().datetime().optional(),\r\n          end: z.string().datetime().optional(),\r\n        })\r\n        .optional(),\r\n    })\r\n    .optional(),\r\n  options: z\r\n    .object({\r\n      spell_correct: z.boolean().optional(),\r\n      exact_match: z.boolean().optional(),\r\n      safe_search: z.boolean().default(true).optional(),\r\n    })\r\n    .optional(),\r\n});\r\n\r\nexport type SearchRequest = z.infer<typeof searchRequestSchema>;\r\n\r\n// Suggestion query validation\r\nexport const suggestionRequestSchema = z.object({\r\n  q: z\r\n    .string()\r\n    .trim()\r\n    .min(1, 'Query must be at least 1 character')\r\n    .max(200, 'Query too long')\r\n    .transform((val) => sanitizeQuery(val)),\r\n  limit: z.number().int().positive().max(20).default(10).optional(),\r\n});\r\n\r\nexport type SuggestionRequest = z.infer<typeof suggestionRequestSchema>;\r\n\r\n// Click event validation\r\nexport const clickEventSchema = z.object({\r\n  search_event_id: z.string().uuid('Invalid search event ID'),\r\n  doc_id: z.string().uuid('Invalid document ID'),\r\n  position: z.number().int().positive().max(1000),\r\n  url: z.string().url('Invalid URL'),\r\n  query: z.string().max(500).optional(),\r\n});\r\n\r\nexport type ClickEvent = z.infer<typeof clickEventSchema>;\r\n\r\n// Admin crawl request validation\r\nexport const crawlRequestSchema = z.object({\r\n  urls: z\r\n    .array(z.string().url('Invalid URL'))\r\n    .min(1, 'At least one URL required')\r\n    .max(1000, 'Too many URLs (max 1000)'),\r\n  priority: z.enum(['low', 'normal', 'high']).default('normal').optional(),\r\n  respect_robots: z.boolean().default(true).optional(),\r\n});\r\n\r\nexport type CrawlRequest = z.infer<typeof crawlRequestSchema>;\r\n\r\n/**\r\n * Sanitizes search query to prevent injection attacks\r\n * Removes potentially dangerous characters while preserving search functionality\r\n */\r\nfunction sanitizeQuery(query: string): string {\r\n  // Remove null bytes\r\n  let sanitized = query.replace(/\\0/g, '');\r\n\r\n  // Remove control characters except newline, carriage return, tab\r\n  sanitized = sanitized.replace(/[\\x00-\\x08\\x0B\\x0C\\x0E-\\x1F\\x7F]/g, '');\r\n\r\n  // Limit consecutive spaces\r\n  sanitized = sanitized.replace(/\\s+/g, ' ');\r\n\r\n  // Remove leading/trailing whitespace\r\n  sanitized = sanitized.trim();\r\n\r\n  // Remove potentially dangerous SQL patterns (defense in depth)\r\n  const dangerousPatterns = [\r\n    /;\\s*(drop|delete|insert|update|create|alter|exec|execute|script)/gi,\r\n    /--/g,\r\n    /\\/\\*/g,\r\n    /\\*\\//g,\r\n  ];\r\n\r\n  for (const pattern of dangerousPatterns) {\r\n    sanitized = sanitized.replace(pattern, '');\r\n  }\r\n\r\n  return sanitized;\r\n}\r\n\r\n/**\r\n * Sanitizes HTML content to prevent XSS attacks\r\n * Strips all HTML tags and converts special characters\r\n */\r\nexport function sanitizeHtml(html: string): string {\r\n  if (!html) return '';\r\n\r\n  // Strip HTML tags\r\n  let sanitized = html.replace(/<[^>]*>/g, '');\r\n\r\n  // Encode special characters\r\n  sanitized = sanitized\r\n    .replace(/&/g, '&amp;')\r\n    .replace(/</g, '&lt;')\r\n    .replace(/>/g, '&gt;')\r\n    .replace(/\"/g, '&quot;')\r\n    .replace(/'/g, '&#x27;')\r\n    .replace(/\\//g, '&#x2F;');\r\n\r\n  return sanitized;\r\n}\r\n\r\n/**\r\n * Validates and sanitizes URLs\r\n */\r\nexport function sanitizeUrl(url: string): string {\r\n  try {\r\n    const parsed = new URL(url);\r\n\r\n    // Only allow http and https protocols\r\n    if (!['http:', 'https:'].includes(parsed.protocol)) {\r\n      throw new Error('Invalid protocol');\r\n    }\r\n\r\n    return parsed.toString();\r\n  } catch {\r\n    throw new Error('Invalid URL format');\r\n  }\r\n}\r\n\r\n/**\r\n * Rate limit check result\r\n */\r\nexport interface RateLimitCheck {\r\n  allowed: boolean;\r\n  remaining: number;\r\n  resetAt: Date;\r\n}\r\n\r\n/**\r\n * Error response structure\r\n */\r\nexport interface ErrorResponse {\r\n  error: {\r\n    code: string;\r\n    message: string;\r\n    details?: any;\r\n  };\r\n  request_id: string;\r\n  timestamp: string;\r\n}\r\n\r\n/**\r\n * Creates a standardized error response\r\n */\r\nexport function createErrorResponse(\r\n  code: string,\r\n  message: string,\r\n  details?: any,\r\n  requestId?: string\r\n): ErrorResponse {\r\n  return {\r\n    error: {\r\n      code,\r\n      message,\r\n      details,\r\n    },\r\n    request_id: requestId || `req_${Date.now()}_${Math.random().toString(36).substring(7)}`,\r\n    timestamp: new Date().toISOString(),\r\n  };\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 158, "column": 0}, "map": {"version":3,"sources":["file:///D:/search-engine-spec/app/api/v1/auth/logout/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\r\nimport { createErrorResponse } from '@/lib/validation/schemas';\r\n\r\nexport async function POST(req: NextRequest) {\r\n  try {\r\n    // Clear the auth cookie\r\n    const response = NextResponse.json({\r\n      success: true,\r\n      message: 'Logged out successfully',\r\n    });\r\n\r\n    response.cookies.set('auth-token', '', {\r\n      httpOnly: true,\r\n      secure: process.env.NODE_ENV === 'production',\r\n      sameSite: 'lax',\r\n      maxAge: 0,\r\n      path: '/',\r\n    });\r\n\r\n    return response;\r\n\r\n  } catch (error) {\r\n    console.error('Logout error:', error);\r\n    return NextResponse.json(\r\n      createErrorResponse(\r\n        'LOGOUT_FAILED',\r\n        'Failed to logout user'\r\n      ),\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,KAAK,GAAgB;IACzC,IAAI;QACF,wBAAwB;QACxB,MAAM,WAAW,gJAAY,CAAC,IAAI,CAAC;YACjC,SAAS;YACT,SAAS;QACX;QAEA,SAAS,OAAO,CAAC,GAAG,CAAC,cAAc,IAAI;YACrC,UAAU;YACV,QAAQ,oDAAyB;YACjC,UAAU;YACV,QAAQ;YACR,MAAM;QACR;QAEA,OAAO;IAET,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,iBAAiB;QAC/B,OAAO,gJAAY,CAAC,IAAI,CACtB,IAAA,qJAAmB,EACjB,iBACA,0BAEF;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}